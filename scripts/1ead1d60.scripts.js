!function(a){"use strict";var b="https://api.parse.com/1",c=a.module("sladsApp",["ngSanitize","ngRoute","ngResource","ngCookies","ngAnimate","mgcrea.ngStrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl",resolve:{auth:["$q","parseService","$location",function(a,b,c){var d=a.defer();return b.currentUser(function(){d.reject(),c.path("/main")},d.resolve),d.promise}]}}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{auth:["$q","parseService","$location",function(a,b,c){var d=a.defer();return b.currentUser(d.resolve,function(){d.reject(),c.path("/")}),d.promise}]}}).when("/modal",{templateUrl:"views/modal.html"}).otherwise({redirectTo:"/"})}]);c.directive("hideFullscreen",["$window",function(b){return{link:function(c,d){a.element(b).bind("resize",function(){b.fullScreen||b.innerWidth===b.screen.width&&b.innerHeight===b.screen.height?d.addClass("ng-hide"):d.removeClass("ng-hide")})}}}]),c.run(["$http","$cookies",function(b,c){b.defaults.headers.common["X-Parse-Application-Id"]="wHOusfpG1kv1wus81ORw8FNwW7V7NP3qXQMfSYdP",b.defaults.headers.common["X-Parse-REST-API-Key"]="JWa79j0JWDFRk14OoWRuRH68Nutf83sA5FdxG4MP",b.defaults.headers.common["X-Parse-Session-Token"]=c.sessionToken,b.defaults.transformResponse.push(function(b){return a.isObject(b)&&b.results?b.results:b})}]),c.factory("model",["$http","$resource",function(a,c){return{User:c(b+"/users/:id",{id:"@objectId"},{me:{method:"GET",url:b+"/users/me"},update:{method:"PUT"}}),Player:c(b+"/classes/Player/:id",{id:"@objectId"},{update:{method:"PUT"}}),Match:c(b+"/classes/Match/:id",{id:"@objectId",include:"winner,loser"},{update:{method:"PUT"}}),Order:c(b+"/classes/Order/:id",{id:"@objectId",include:"user"})}}]),c.factory("parseService",["$http","$cookies","model",function(a,c,d){return{login:function(d,e){var f=a({url:b+"/login",method:"GET",params:{username:d,password:e}});return f.success(function(b){a.defaults.headers.common["X-Parse-Session-Token"]=b.sessionToken,c.sessionToken=b.sessionToken}),f},logout:function(){delete a.defaults.headers.common["X-Parse-Session-Token"],delete c.sessionToken},currentUser:function(a,b){return d.User.me({},a,b)}}}])}(this.angular),function(a){"use strict";var b=a.module("sladsApp");b.controller("MainCtrl",["$scope","$location","$window","$interval","parseService",function(b,c,d,e,f){var g,h=function(){return d.fullScreen||d.innerWidth===d.screen.width&&d.innerHeight===d.screen.height},i=function(){b.page="ladder"===b.page?"orders":"ladder"};a.element(d).bind("resize",function(){a.isDefined(g)&&(e.cancel(g),g=void 0),h()&&(g=e(i,1e4))}),f.currentUser(function(a){b.currentUser=a}),b.page="ladder",b.logout=function(){f.logout(),c.path("/")},b.showPage=function(a){b.page=a}}])}(this.angular),function(a){"use strict";var b=a.module("sladsApp");b.controller("LoginCtrl",["$scope","$location","parseService",function(a,b,c){a.login=function(d,e){c.login(d,e).success(function(){b.path("/main")}).error(function(b){a.formError=b.error})}}])}(this.angular),function(a){"use strict";var b=a.module("sladsApp");b.controller("LadderCtrl",["$scope","$modal","model",function(a,b,c){var d=function(){a.players=c.Player.query()};d();var e=function(){a.matches=c.Match.query()};e();var f=function(a){return a.firstName+" "+a.lastName};a.matchData=function(a){return f(a.winner)+" "+a.winnerGoals+"-"+a.loserGoals+" "+f(a.loser)},a.ladder=[];var g=function(){var b=a.players.map(function(b){var c={name:f(b)};return c.wins=a.matches.reduce(function(a,c){return c.winner.objectId===b.objectId?a+1:a},0),c.for=a.matches.reduce(function(a,c){return c.winner.objectId===b.objectId?a+c.winnerGoals:c.loser.objectId===b.objectId?a+c.loserGoals:a},0),c.losses=a.matches.reduce(function(a,c){return c.loser.objectId===b.objectId?a+1:a},0),c.against=a.matches.reduce(function(a,c){return c.loser.objectId===b.objectId?a+c.winnerGoals:c.winner.objectId===b.objectId?a+c.loserGoals:a},0),c.gd=c.for-c.against,c.played=c.wins+c.losses,c.wp=Math.round(c.wins/c.played*1e4)/100,c});b.sort(function(a,b){return b.wp-a.wp}),a.ladder=b};a.$watchCollection("matches",g),a.$watchCollection("players",g),a.playerName=f;var h=function(a){return function(b){a.error=b.data.error}};a.openMatchModal=function(d){var f=a.$new();f.title="Match";var g=a.players.map(function(a){return{name:a.firstName+" "+a.lastName,id:a.objectId}}),i=d?d.winner.objectId:void 0,j=d?d.loser.objectId:void 0,k=d?d.winnerGoals:0,l=d?d.loserGoals:0,m=[{label:"Winner",type:"select",values:g,value:i},{label:"Points",type:"number",value:k},{label:"Loser",type:"select",values:g,value:j},{label:"Points",type:"number",value:l}];f.fields=m;var n=b({template:"views/modal.html",scope:f});f.save=function(a){var b=d||new c.Match;b.winnerGoals=a[1].value,b.loserGoals=a[3].value,b.winner={__type:"Pointer",className:"Player",objectId:a[0].value},b.loser={__type:"Pointer",className:"Player",objectId:a[2].value};var g=function(){e(),n.hide()};b.objectId?b.$update(g,h(f)):b.$save(g,h(f))}},a.openPlayerModal=function(f){var g=a.$new();g.title="Player";var i=f?f.firstName:void 0,j=f?f.lastName:void 0,k=[{label:"First name",type:"text",value:i,placeholder:"First name"},{label:"Last name",type:"text",value:j,placeholder:"Last name"}];g.fields=k;var l=b({template:"views/modal.html",scope:g});g.save=function(a){var b=f||new c.Player;b.firstName=a[0].value,b.lastName=a[1].value;var i=function(){d(),e(),l.hide()};b.objectId?b.$update(i,h(g)):b.$save(i,h(g))}}}])}(this.angular),function(a){"use strict";var b=a.module("sladsApp");b.controller("OrdersCtrl",["$scope","$modal","parseService","model",function(a,b,c,d){a.orders=[],a.products=[];var e=function(){a.orders=d.Order.query()};e(),a.order=function(){var f=a.$new();f.title="Order";var g=[{label:"Content",type:"text",placeholder:"Insert order as text"}];f.fields=g;var h=b({template:"views/modal.html",scope:f});f.save=function(a){c.currentUser(function(b){var c=new d.Order;c.user={__type:"Pointer",className:"_User",objectId:b.objectId},c.content=a[0].value,c.$save(function(){e(),h.hide()})})}},a.clear=function(){var b=function(a){if(a.length>0){var c=a.pop();console.log(c),c.$remove(function(){b(a)})}else e()};b(a.orders)}}])}(this.angular),function(a){"use strict";var b=a.module("sladsApp");b.controller("AdminCtrl",["$scope","$location","parseService",function(a,b,c){a.changePassword=function(b){c.currentUser(function(d){c.login(d.username,b.old).success(function(){d.password=b.new,delete d.sessionToken,d.$update(function(){a.success=!0,a.message="Success"},function(b){a.success=!1,a.message=b.error})}).error(function(b){a.success=!1,a.message=b.error})})}}])}(this.angular);